<div class="shopping-cart-content">
	<mat-expansion-panel
		(opened)="panelOpenState = true"
		(closed)="panelOpenState = false"
		*ngFor="let product of shoppingCartService.products; let i = index"
		class="product-panel"
	>
		<mat-expansion-panel-header>
			<mat-panel-title>
				<img
					[src]="product.image"
					alt="product-img"
					class="product-img"
				/>
				{{ product.title }} ({{ product.size }})</mat-panel-title
			>

			<mat-panel-description>
				<div>
					Price:
					{{
						product.price * exchangeRateService.selectedRate
							| number : '1.2-2'
					}}{{ exchangeRateService.icon }}
				</div>
				<div class="quantity-container">
					<mat-icon (click)="incrementQuantity(i, $event)"
						>add_circle</mat-icon
					>
					<div class="quantity-box">{{ product.quantity }}</div>
					<mat-icon (click)="decreaseQuantity(i, $event)"
						>do_not_disturb_on</mat-icon
					>
				</div>
				<div class="total-container">
					Item Total:
					{{
						product.price *
							product.quantity *
							exchangeRateService.selectedRate | number : '1.2-2'
					}}
					{{ exchangeRateService.icon }}
				</div>
			</mat-panel-description>
		</mat-expansion-panel-header>

		<div class="product-detail-container">
			<div class="img-description-wrapper">
				<div class="description-infos">
					<h1>{{ product.title }}</h1>
					<p>{{ product.description }}</p>
					<div class="info-row">
						<div class="info">Size: {{ product.size }}</div>
						<div class="info">
							Bought: {{ product.rating.count }} Times
						</div>
						<div class="stars">
							<mat-icon
								*ngFor="
									let star of [0, 1, 2, 3, 4];
									let i = index
								"
								[ngClass]="{
									filled: i + 1 < product.rating.rate
								}"
								>star</mat-icon
							>
							(Rating: {{ product.rating.rate }})
						</div>
					</div>
				</div>
				<img
					[src]="product.image"
					alt="product-img"
					class="product-img"
				/>
			</div>
		</div>
	</mat-expansion-panel>

	<div
		class="checkout-container"
		*ngIf="shoppingCartService.products.length > 0"
	>
		<mat-card>
			<div>
				<span>Subtotal:</span
				><span>
					{{
						shoppingCartService.totalPrice *
							exchangeRateService.selectedRate | number : '1.2-2'
					}}{{ exchangeRateService.icon }}</span
				>
			</div>
			<div>
				<span>Shipping:</span>
				<span
					>{{
						shoppingCartService.shippingCosts *
							exchangeRateService.selectedRate | number : '1.2-2'
					}}{{ exchangeRateService.icon }}</span
				>
			</div>
			<div>
				<span>Coupon:</span>
				<mat-form-field>
					<mat-label>Code</mat-label>
					<input
						matInput
						placeholder="Enter Code here"
						value=""
						maxlength="5"
						(input)="validateDiscount()"
						[(ngModel)]="discountCode"
						[ngClass]="{ valid: discountGiven }"
					/>
				</mat-form-field>
			</div>
			<div *ngIf="discountGiven">
				<span>Discount:</span>
				<span class="discount"
					>+ {{ this.discount * exchangeRateService.selectedRate
					}}{{ exchangeRateService.icon }}</span
				>
			</div>
			<div>
				<span> Grand Total: </span>
				<span>
					{{
						(shoppingCartService.shippingCosts +
							shoppingCartService.totalPrice -
							this.discount) *
							exchangeRateService.selectedRate | number : '1.2-2'
					}}{{ exchangeRateService.icon }}
				</span>
			</div>
			<h2 class="payment-header">Payment Options</h2>
			<div>
				<div
					class="payment-option-wrapper"
					(click)="selectPayment('credit')"
				>
					<mat-icon [class.selected]="paymentMethod === 'credit'"
						>credit_card</mat-icon
					>
					Credit Card
				</div>
				<div
					class="payment-option-wrapper"
					(click)="selectPayment('paypal')"
				>
					<mat-icon [class.selected]="paymentMethod === 'paypal'"
						>paid</mat-icon
					>
					Paypal
				</div>
				<div
					class="payment-option-wrapper"
					(click)="selectPayment('debit')"
				>
					<mat-icon [class.selected]="paymentMethod === 'debit'"
						>newspaper</mat-icon
					>
					Direct Debit
				</div>
			</div>

			<button class="payment-button">Proceed to Payment</button>
		</mat-card>
	</div>

	<div
		class="empty-cart-prompt"
		*ngIf="shoppingCartService.products.length === 0"
	>
		<mat-icon>shopping_cart</mat-icon>
		<h3>Shopping Cart is empty</h3>
		<button [routerLink]="''">Explore products</button>
	</div>
</div>
